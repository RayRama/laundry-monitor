<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leaderboard Events • Whoooshlab Smartlink</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/styles/dashboard.css" />
    <link rel="stylesheet" href="/styles/leaderboard.css" />
  </head>
  <body class="h-full bg-gray-50">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <p class="loading-text">Memuat data...</p>
      </div>
    </div>

    <header
      class="sticky top-0 z-30 border-b border-slate-200 bg-white/80 backdrop-blur"
    >
      <div class="max-w-7xl mx-auto px-3 sm:px-4 lg:px-6 py-2 sm:py-3">
        <div class="flex items-center gap-2 sm:gap-3">
          <!-- Logo -->
          <div
            class="w-8 h-8 sm:w-9 sm:h-9 rounded-xl bg-sky-500 flex items-center justify-center text-white font-black text-sm sm:text-base flex-shrink-0"
          >
            WL
          </div>

          <!-- Title Section -->
          <div class="flex-1 min-w-0">
            <h1
              class="text-sm sm:text-base lg:text-lg font-extrabold tracking-tight text-slate-900 truncate"
            >
              <span class="hidden sm:inline"
                >Leaderboard Events • Whoooshlab Smartlink</span
              >
              <span class="sm:hidden">Events</span>
            </h1>
            <p class="text-slate-500 text-xs sm:text-sm -mt-0.5 truncate">
              <span class="hidden sm:inline"
                >Frequency events per machine breakdown</span
              >
              <span class="sm:hidden">Event frequency</span>
            </p>
          </div>

          <!-- Navigation Menu (Admin Only) -->
          <div class="hidden admin-nav flex items-center gap-1 sm:gap-2 mr-2">
            <a
              href="/dashboard"
              class="btn btn-outline text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2"
            >
              Dashboard
            </a>
            <a
              href="/monitor"
              class="btn btn-outline text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2"
            >
              Monitor
            </a>
          </div>

          <!-- Action Buttons -->
          <div class="flex items-center gap-1 sm:gap-2 flex-shrink-0">
            <!-- Live Badge -->
            <span
              class="pill pill-amber text-xs sm:text-sm hidden sm:inline-flex"
              >Live</span
            >
            <span class="pill pill-amber text-xs sm:inline-flex md:hidden"
              >●</span
            >

            <!-- Refresh Button -->
            <button
              id="refreshEvents"
              class="btn btn-primary refresh-btn text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="w-3 h-3 sm:w-4 sm:h-4 sm:mr-1"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"
                />
              </svg>
              <span class="hidden sm:inline">Refresh</span>
            </button>

            <!-- Logout Button -->
            <button
              class="logout-btn btn btn-secondary text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2"
              title="Logout"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="w-3 h-3 sm:w-4 sm:h-4 sm:mr-1"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <path
                  d="M16 17v-3H9v-4h7V7l5 5-5 5zM14 2c1.1 0 2 .9 2 2v2h-2V4H4v16h10v-2h2v2c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10z"
                />
              </svg>
              <span class="hidden sm:inline">Logout</span>
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="max-w-7xl mx-auto p-4 sm:p-6 space-y-6">
      <!-- Filter Section -->
      <div class="filter-section">
        <div class="filter-row">
          <div class="filter-group">
            <label for="filterSelect">Filter Data</label>
            <select id="filterSelect" class="filter-select">
              <option value="today" selected>Hari Ini</option>
              <option value="yesterday">Kemarin</option>
              <option value="this_week">Minggu Ini</option>
              <option value="last_7_days">7 Hari Terakhir</option>
              <option value="this_month">Bulan Ini</option>
              <option value="this_year">Tahun Ini</option>
              <option value="custom">Custom</option>
            </select>
          </div>

          <div class="filter-group" id="customDateGroup" style="display: none">
            <label for="startDate">Tanggal Awal</label>
            <input type="date" id="startDate" class="filter-input" />
          </div>

          <div class="filter-group" id="customDateGroup2" style="display: none">
            <label for="endDate">Tanggal Akhir</label>
            <input type="date" id="endDate" class="filter-input" />
          </div>

          <div class="filter-group">
            <button id="applyFilter" class="btn btn-primary">
              Terapkan Filter
            </button>
          </div>
        </div>
      </div>

      <!-- Data Range Info -->
      <div id="data-range-info" class="data-range-info">
        <div class="range-text">Memuat data...</div>
      </div>

      <!-- Events Table -->
      <!-- Events Table -->
      <div class="leaderboard-section space-y-8">
        <!-- Washer Section -->
        <div class="leaderboard-card">
          <div class="leaderboard-header">
            <h3 class="leaderboard-subtitle">Washer Machines</h3>
            <div class="leaderboard-stats">
              <span class="stat-item">
                <span class="stat-label">Total Mesin:</span>
                <span id="totalWasherMachines" class="stat-value">-</span>
              </span>
            </div>
          </div>
          <div id="washerTableContainer" class="border rounded-lg overflow-hidden bg-white shadow-sm">
            <div class="max-h-[500px] overflow-y-auto relative custom-scrollbar">
              <table id="washerTable" class="w-full text-left border-collapse" style="display: none">
                <thead class="bg-gray-50 sticky top-0 z-10 shadow-sm">
                  <tr class="border-b border-gray-200">
                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider bg-gray-50">Rank</th>
                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider bg-gray-50">Mesin</th>
                    <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100 group bg-gray-50 select-none" data-sort="transaksi" data-table="washer">
                      <div class="flex items-center justify-end gap-1">
                        Transaksi
                        <span class="sort-icon text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity">↕</span>
                      </div>
                    </th>
                    <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100 group bg-gray-50 select-none" data-sort="drop_off" data-table="washer">
                      <div class="flex items-center justify-end gap-1">
                        Drop Off
                        <span class="sort-icon text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity">↕</span>
                      </div>
                    </th>
                    <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100 group bg-gray-50 select-none" data-sort="error_payment" data-table="washer">
                      <div class="flex items-center justify-end gap-1">
                        Error Payment
                        <span class="sort-icon text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity">↕</span>
                      </div>
                    </th>
                    <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100 group bg-gray-50 select-none" data-sort="cuci_kosong" data-table="washer">
                      <div class="flex items-center justify-end gap-1">
                        Cuci Kosong
                        <span class="sort-icon text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity">↕</span>
                      </div>
                    </th>
                    <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100 group bg-gray-50 select-none" data-sort="employee_quota" data-table="washer">
                      <div class="flex items-center justify-end gap-1">
                        Employee Quota
                        <span class="sort-icon text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity">↕</span>
                      </div>
                    </th>
                    <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100 group bg-gray-50 select-none" data-sort="tube_clean" data-table="washer">
                      <div class="flex items-center justify-end gap-1">
                        Tube Clean
                        <span class="sort-icon text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity">↕</span>
                      </div>
                    </th>
                    <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100 group bg-gray-50 select-none" data-sort="total" data-table="washer">
                      <div class="flex items-center justify-end gap-1">
                        Total
                        <span class="sort-icon text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity">↕</span>
                      </div>
                    </th>
                  </tr>
                </thead>
                <tbody id="washerTableBody" class="bg-white divide-y divide-gray-200">
                  <!-- Table rows will be inserted here -->
                </tbody>
                <tfoot id="washerTableFooter" class="bg-gray-50 border-t border-gray-200 font-bold sticky bottom-0 shadow-inner z-10">
                  <!-- Total row will be inserted here -->
                </tfoot>
              </table>
              <div id="washerTableLoading" class="loading-placeholder p-8 text-center text-gray-500">Memuat data Washer...</div>
              <div id="washerTableEmpty" class="empty-state p-8 text-center text-gray-500" style="display: none">Tidak ada data Washer</div>
            </div>
          </div>
        </div>

        <!-- Dryer Section -->
        <div class="leaderboard-card">
          <div class="leaderboard-header">
            <h3 class="leaderboard-subtitle">Dryer Machines</h3>
            <div class="leaderboard-stats">
              <span class="stat-item">
                <span class="stat-label">Total Mesin:</span>
                <span id="totalDryerMachines" class="stat-value">-</span>
              </span>
            </div>
          </div>
          <div id="dryerTableContainer" class="border rounded-lg overflow-hidden bg-white shadow-sm">
            <div class="max-h-[500px] overflow-y-auto relative custom-scrollbar">
              <table id="dryerTable" class="w-full text-left border-collapse" style="display: none">
                <thead class="bg-gray-50 sticky top-0 z-10 shadow-sm">
                  <tr class="border-b border-gray-200">
                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider bg-gray-50">Rank</th>
                    <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider bg-gray-50">Mesin</th>
                    <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100 group bg-gray-50 select-none" data-sort="transaksi" data-table="dryer">
                      <div class="flex items-center justify-end gap-1">
                        Transaksi
                        <span class="sort-icon text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity">↕</span>
                      </div>
                    </th>
                    <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100 group bg-gray-50 select-none" data-sort="drop_off" data-table="dryer">
                      <div class="flex items-center justify-end gap-1">
                        Drop Off
                        <span class="sort-icon text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity">↕</span>
                      </div>
                    </th>
                    <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100 group bg-gray-50 select-none" data-sort="error_payment" data-table="dryer">
                      <div class="flex items-center justify-end gap-1">
                        Error Payment
                        <span class="sort-icon text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity">↕</span>
                      </div>
                    </th>
                    <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100 group bg-gray-50 select-none" data-sort="cuci_kosong" data-table="dryer">
                      <div class="flex items-center justify-end gap-1">
                        Cuci Kosong
                        <span class="sort-icon text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity">↕</span>
                      </div>
                    </th>
                    <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100 group bg-gray-50 select-none" data-sort="employee_quota" data-table="dryer">
                      <div class="flex items-center justify-end gap-1">
                        Employee Quota
                        <span class="sort-icon text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity">↕</span>
                      </div>
                    </th>
                    <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100 group bg-gray-50 select-none" data-sort="tube_clean" data-table="dryer">
                      <div class="flex items-center justify-end gap-1">
                        Tube Clean
                        <span class="sort-icon text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity">↕</span>
                      </div>
                    </th>
                    <th class="px-4 py-3 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider cursor-pointer hover:bg-gray-100 group bg-gray-50 select-none" data-sort="total" data-table="dryer">
                      <div class="flex items-center justify-end gap-1">
                        Total
                        <span class="sort-icon text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity">↕</span>
                      </div>
                    </th>
                  </tr>
                </thead>
                <tbody id="dryerTableBody" class="bg-white divide-y divide-gray-200">
                  <!-- Table rows will be inserted here -->
                </tbody>
                <tfoot id="dryerTableFooter" class="bg-gray-50 border-t border-gray-200 font-bold sticky bottom-0 shadow-inner z-10">
                  <!-- Total row will be inserted here -->
                </tfoot>
              </table>
              <div id="dryerTableLoading" class="loading-placeholder p-8 text-center text-gray-500">Memuat data Dryer...</div>
              <div id="dryerTableEmpty" class="empty-state p-8 text-center text-gray-500" style="display: none">Tidak ada data Dryer</div>
            </div>
          </div>
        </div>
        
        <!-- Shared Error State -->
        <div id="globalTableError" class="error-state" style="display: none"></div>
      </div>

      <!-- Footer -->
      <div class="footer-note text-center">
        <p>&copy; 2025 • Whoooshlab Analytics • Powered by Smartlink API</p>
      </div>
    </main>

    <script src="/scripts/auth.js"></script>
    <script src="/scripts/leaderboardEvents.js"></script>
    <script>
      // Require admin access and show navigation menu
      document.addEventListener("DOMContentLoaded", function () {
        // Check admin access first
        if (!Auth.requireAdmin()) {
          return; // Will redirect if not admin
        }

        // Show admin navigation menu
        const adminNav = document.querySelector(".admin-nav");
        if (adminNav) {
          adminNav.classList.remove("hidden");
        }
      });
    </script>
  </body>
</html>
